def recalculer_acquisition_mensuelle(self, as_of=None, save=True): if as_of is
None: as_of = timezone.now().date() self.annee = as_of.year date_aff =
parse_date(getattr(self.personnel, "date_affectation", None)) if not date_aff:
return part = _quant(Decimal(self.conge_initial) / Decimal(12)) mois_courant =
as_of.month result = {f"{m:02d}": Decimal("0.00") for m in range(1, 13)} if
date_aff.year == self.annee: mois_debut = date_aff.month mois_range =
range(mois_debut, mois_courant + 1) elif date_aff.year < self.annee: mois_range
= range(1, mois_courant + 1) else: mois_range = [] for m in mois_range:
result[f"{m:02d}"] = part self.conge_mensuel_restant = {k: float(v) for k, v in
result.items()} self.conge_restant_annee_courante = sum(result.values())
self.recalculer_total_conges(save=False) if save: self.save()
